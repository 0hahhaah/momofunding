# *ÎπåÎìú Î∞è Î∞∞Ìè¨ Í¥ÄÎ†® Ï†ïÎ¶¨*

## **ÏÇ¨Ïö©Ìïú JVM ,ÏõπÏÑúÎ≤Ñ, WAS Ï†úÌíà Îì±Ïùò Ï¢ÖÎ•òÏôÄ ÏÑ§Ï†ïÍ∞í, Î≤ÑÏ†Ñ(IDE Î≤ÑÏ†Ñ Ìè¨Ìï®)**

| Name               | Version       | Description                |
| ------------------ | ------------- | -------------------------- |
| Docker             | 20.10.12      |                            |
| MariaDB            | 10.6.5        | Database                   |
| NGINX              | 1.18.0        | Web server                 |
| Java               | 1.8           |                            |
| JVM                | 1.8.0_192     |                            |
| Gradle             | 7.3.2         | Build Tool                 |
| SpringBoot         | 2.6.2         |                            |
| openvidu-react     | 2.20.0        |                            |
| React.js           | 17.0.2        |                            |
| node               | 16.13.1       |                            |
| IntelliJ IDEA      | 2021.3.1      | IDE - Spring Boot          |
| Visual Studio Code | 1.64.2        | IDE - React.js             |
| MySQL Workbench    | 8.0.21        | DB Management Tool         |
    
## **ÎπåÎìú Ïãú ÏÇ¨Ïö©ÎêòÎäî ÌôòÍ≤Ω Î≥ÄÏàò Îì±Ïùò Ï£ºÏöî ÎÇ¥Ïö© ÏÉÅÏÑ∏**
* ÏÑúÎ≤Ñ(i6a202.p.ssafy.io)ÏóêÏÑú ÎπåÎìú Ïãú ÏÑúÎ≤ÑÏö© ÏΩîÎìúÎ•º ÏÇ¨Ïö©Ìï¥Ïïº ÌïòÍ≥†, (Î°úÏª¨Ïö© ÏΩîÎìúÎäî Ï£ºÏÑù)   
Î°úÏª¨ÏóêÏÑú ÎπåÎìú Ïãú Î°úÏª¨Ïö© ÏΩîÎìúÎ•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.(ÏÑúÎ≤ÑÏö© ÏΩîÎìúÎäî Ï£ºÏÑù)
  * springbootÏùò application.yml ÌååÏùº
  ```yml
  h2:
      console:
        enabled: true
    servlet:
      multipart:
        #location: /var/images # ÏÑúÎ≤ÑÏÑ§Ï†ï
        location: C:\SSAFY\Temp\upload  # Î°úÏª¨ ÏÑ§Ï†ï

  ...
  ...
  ...

  #pathSeparator: / # ÏÑúÎ≤ÑÏÑ§Ï†ï
  #serverApiUrl: "https://i6a202.p.ssafy.io/api/" # ÏÑúÎ≤ÑÏÑ§Ï†ï
  #serverFrontUrl : "https://i6a202.p.ssafy.io/" # ÏÑúÎ≤ÑÏÑ§Ï†ï

  pathSeparator: \  # Î°úÏª¨ ÏÑ§Ï†ï
  serverApiUrl: "http://localhost:8080/api/"  # Î°úÏª¨ ÏÑ§Ï†ï
  serverFrontUrl : "http://localhost:3000/"   # Î°úÏª¨ ÏÑ§Ï†ï
  ```

  * react frontend Ìè¥ÎçîÏóêÏÑú App.js
  ```jsx
  //41 line
  //ÏÑúÎ≤ÑÏö©
  // export const baseUrl = "https://i6a202.p.ssafy.io/api";
  // export const baseUrlNoApi = "https://i6a202.p.ssafy.io";

  //Î°úÏª¨Ïö©
  export const baseUrl = "http://localhost:8080/api";
  export const baseUrlNoApi = "http://localhost:3000";
  ```
* FE Ïã§Ìñâ
  * local
    * App.jsÌååÏùº Î°úÏª¨ ÏΩîÎìú ÏÇ¨Ïö©
  ```bash
    npm install
    npm start
  ```
  * server
    * App.jsÌååÏùº ÏÑúÎ≤Ñ ÏΩîÎìú ÏÇ¨Ïö©
    * localÏóêÏÑú ÎπåÎìú ÌïÑÏöî
    ```bash
    npm run build
    ```
    * ÎπåÎìú ÌååÏùº(/build)Î•º ÏÑúÎ≤Ñ ÌîÑÎ°†Ìä∏ ÎèÑÏª§ Ìè¥ÎçîÎ°ú Ïù¥Îèô(/home/ubuntu/reactDocker/dd/)
      * Í∏∞Ï°¥ build Ìè¥Îçî Ï°¥Ïû¨ Ïãú ÏÇ≠Ï†ú ÌïÑÏöî
      * /home/ubuntu/reactDocker/dd/ÏóêÏÑú Î™ÖÎ†πÏñ¥ Ïã§Ìñâ
    ```bash
    docker stop react-app && docker rm react-app
    docker rmi $(docker images | grep "react-app") # Ïã§Ìñâ Ïãú Îπ®Í∞Ñ Ï§Ñ Îú®Î©¥ ÌïúÎ≤à Îçî ÏûÖÎ†•
    docker build -t react-app -f Dockerfile .
    docker run --name react-app -d -p 3000:3000 react-app
    ```
* BE Ïã§Ìñâ
  * local
    * application.ymlÌååÏùº Î°úÏª¨ ÏΩîÎìú ÏÇ¨Ïö©
    ```
    IDE Ïã§Ìñâ
    ```
  * server
    * application.ymlÌååÏùº ÏÑúÎ≤Ñ ÏΩîÎìú ÏÇ¨Ïö©
    * ÎπåÎìú ÌååÏùº ÌïÑÏöî
      * Ïù∏ÌÖîÎ¶¨Ï†úÏù¥ Ïö∞Ï∏° ÏÉÅÎã® Gradle ÌÅ¥Î¶≠ > momofunding > Tasks > build > bootJar ÎçîÎ∏îÌÅ¥Î¶≠
    * /momofunding/build/libsÌè¥ÎçîÏùò .jar ÌååÏùºÏùÑ ÏÑúÎ≤Ñ /home/ubuntu/filezillaTest/Ïóê ÏòÆÍ∏∞Í∏∞
    * /home/ubuntu/filezillaTest/Î°ú Ïù¥Îèô ÌõÑ Î™ÖÎ†πÏñ¥ Ïã§Ìñâ
    ```bash
    docker stop springboot
    docker rm springboot
    docker rmi filezillatest_application
    docker-compose up -d
    ```


## **Î∞∞Ìè¨ Ïãú ÌäπÏù¥ÏÇ¨Ìï≠ Í∏∞Ïû¨**
  * ÏàòÎèôÎ∞∞Ìè¨ÏûÖÎãàÎã§.
  ---
  * Ïã§Ìñâ Ïãú /creator/default.png Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§.
  ```bash
  # ÎßàÏö¥ÌåÖÎêú Î°úÏª¨ Ïù¥ÎØ∏ÏßÄ Ìè¥Îçî Ï∞æÍ∏∞
  docker volume ls
  # Î™©Î°ù Ï§ë Î∞±ÏóîÎìú ÎèÑÏª§ Ìè¥Îçî Ïù¥ÎØ∏ÏßÄ Î¶¨ÏÜåÏä§ Ïù¥Î¶ÑÏùÑ Ï∞æÏùå(ex. filezillatest_spring_resources)
  # Ï∞æÏùÄ Ïù¥Î¶ÑÏúºÎ°ú, Ïó∞Í≤∞Îêú Î°úÏª¨ ÌååÏùºÏùÑ Ï∞æÏùå
  docker volume inspect filezillatest_spring_resources
  ```
  * Ï∞∏Í≥†Ïö© Î∞òÌôòÎç∞Ïù¥ÌÑ∞   
    ![image](/uploads/ea235f3ddb55895017b0d37312dcea83/image.png)
  * ÎßàÏö¥ÌåÖÎêú Î°úÏª¨ Ìè¥ÎçîÎ•º Ï∞æÏïÑ /creator/default.png ÌååÏùºÏùÑ Ï†ÄÏû•Ìï¥Ï§òÏïº Ìï©ÎãàÎã§.
  ---
  * ÏÑúÎ≤ÑÏóêÏÑúÏùò Ï¥àÍ∏∞ Î∞∞Ìè¨ ÌôòÍ≤Ω ÏÑ∏ÌåÖ(ÎèÑÏª§, SpringBoot, DB ÏÑ§Ïπò Îì±)ÏùÄ Î¨∏ÏÑú Ï†úÏùº ÌïòÎã®Ïóê ÏúÑÏπòÌï¥ ÏûàÏäµÎãàÎã§.
  ---
  * Î∞∞Ìè¨ Î∞©Î≤ï
    * NGINX
      ```bash
      docker stop react-nginx && docker rm react-nginx
      docker rmi $(docker images | grep "nginx-react")
      docker build -t nginx-react:0.1 -f Dockerfile.nginx .
      docker run -d --name react-nginx -p 443:443 -p 80:80 nginx-react:0.1
      # ngninx restart
      # docker exec -it react-nginx service nginx restart
      ```
    * Frontend(React)
      * Î°úÏª¨ÏóêÏÑú frontend/App.jsÏùò ÏÑúÎ≤ÑÏö© ÏΩîÎìúÎ°ú Ï£ºÏÑù Ìï¥Ï†ú(Î°úÏª¨Ïö© ÏΩîÎìúÎäî Ï£ºÏÑù Ï≤òÎ¶¨)
      * npm run buildÎ°ú ÎπåÎìú ÌõÑ buildÌè¥ÎçîÎ•º ÏÑúÎ≤Ñ ./reactDocker/dd/Ïóê Î≥µÏÇ¨
      * home/ubuntu/reactDocker/ddÌè¥ÎçîÎ°ú Ïù¥Îèô, Î™ÖÎ†πÏñ¥ ÏûÖÎ†•
      ```bash
      docker stop react-app && docker rm react-app
      docker rmi $(docker images | grep "react-app")
      docker build -t react-app -f Dockerfile .
      docker run --name react-app -d -p 3000:3000 react-app
      ```
    * Backend(SpringBoot)
      * Î°úÏª¨ÏóêÏÑú application.yml ÌååÏùºÏùò ÏÑúÎ≤ÑÏö© ÏΩîÎìúÎ°ú Ï£ºÏÑù Ìï¥Ï†ú(Î°úÏª¨Ïö© ÏΩîÎìúÎäî Ï£ºÏÑù Ï≤òÎ¶¨)
      * ÎπåÎìúÎêú .jar ÌååÏùºÏùÑ ÏÑúÎ≤Ñ ./filezillaTest/Ïóê Î≥µÏÇ¨
      * home/ubuntu/filezillaTest/Ìè¥ÎçîÎ°ú Ïù¥Îèô, Î™ÖÎ†πÏù¥ ÏûÖÎ†•
      ```bash
      docker stop springboot
      docker rm springboot
      docker rmi filezillatest_application
      docker-compose up -d
      ```
    
## **DBÏ†ëÏÜç Ï†ïÎ≥¥ Îì± ÌîÑÎ°úÏ†ùÌä∏(ERD)Ïóê ÌôúÏö©ÎêòÎäî Ï£ºÏöî Í≥ÑÏ†ï Î∞è ÌîÑÎ°úÌçºÌã∞Í∞Ä Ï†ïÏùòÎêú ÌååÏùº Î™©Î°ù**
* backend/momofunding/build.gradle
* backend/momofunding/src/main/resources/application.yml
* ÌîÑÎ°†Ìä∏ Î≠ê...ÏûàÎÇòÏöî...?
* DB Ï†ëÏÜç Ïãú
  * Î™ÖÎ†πÏñ¥
  ```bash
  docker exec -it database mariadb -u root -p
  ```
  * Í≥ÑÏ†ï Ï†ïÎ≥¥
    * user: root
    * password: root
    
    
    
---
üìåÏù¥ÌïòÎäî Ï∞∏Í≥† Ïö©ÎèÑÏùò  Ï¥àÍ∏∞ ÏÑúÎ≤Ñ Î∞∞Ìè¨ ÌôòÍ≤Ω ÏÑ§Ï†ï Î∞©Î≤ïÏûÖÎãàÎã§.

- ÎèÑÏª§ ÏÑ§Ïπò

```bash
sudo apt-get update #: ÏµúÏã†ÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
sudo apt-get upgrade #: ÏóÖÍ∑∏Î†àÏù¥Îìú(Ìï®Î∂ÄÎ°ú ÌïòÏßÄ ÎßêÍ≤É!! => Î≤ÑÏ†ÑÏù¥ Îã¨ÎùºÏ†∏ÏÑú Ïïà Îê† ÏàòÎèÑ ÏûàÏùå)
#================================== docker install ================================== 
curl -fsSL¬†[https://get.docker.com/](https://get.docker.com/)¬†| sudo sh #: ÎèÑÏª§ ÏÑ§Ïπò
sudo apt-get install curl #: curlÏù¥ ÏóÜÎã§Î©¥ ÏÑ§Ïπò
sudo usermod -aG docker $USER #: ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í∂åÌïú Ï£ºÍ∏∞   
#=> Ïù¥Ï†úÎ∂ÄÌÑ∞ cliÏóêÏÑú dockerÎ™ÖÎ†πÏñ¥ ÏÇ¨Ïö©Í∞ÄÎä•
```

- BE ÏÑ§Ïπò

```bash
# ÎèÑÏª§Ïóê DB, SpringBoot ÏÑ§Ïπò
docker run --name database -dit -p 3306:3306 --restart=always -e MYSQL_ROOT_PASSWORD=root mariadb
docker run -dit -p 8080:8080 --name springboot --link database springboot
```

- BE - Dockerfile

```bash
FROM openjdk:8-jdk-alpine
ARG JAR_FILE=./*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

- BE - docker-compose.yml ÌååÏùº

```bash
version: "3.2"
services:
  database:
    container_name: database
    image: mariadb
    environment:
      - MYSQL_DATABASE=momofunding
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_ROOT_HOST=%
    command: ['--character-set-server=utf8mb4', '--collation-server=utf8mb4_unicode_ci']
    ports:
      - 3306:3306

  application:
    container_name: springboot
    build: .
    environment:
      SPRING_DATASOURCE_URL: jdbc:mariadb://database:3306/momofunding?characterEncoding=UTF-8&serverTimezone=UTC
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: root
    ports:
      - 8080:8080
    depends_on:
      - database
    volumes:
      - spring_resources:/var/images

volumes:
  spring_resources:
```

- FE - Dockerfile

```bash
FROM node:14.15.4

RUN npm install -g serve

RUN mkdir ./build
COPY ./build ./build

ENTRYPOINT ["serve", "-s", "build"]
```

- FE - docker-compose.yml

```bash
version: "3"
services:
  web:
    stdin_open: true
    environment:
      - CHOKIDAR_USEPOLLING=true
    build:
      context: .
      dockerfile: Dockerfile.nginx
    ports:
      - "3000:3000"
    volumes:
      - "/app/node_modules"
      - ".:/app"
      - "/etc/letsencrypt/:/etc/letsencrypt/"
      - "/etc/ssl/:/etc/ssl/"
    restart: always
```

- FE - Î∞∞Ìè¨ Î∞©Î≤ï

```bash
docker stop react-app && docker rm react-app
docker rmi $(docker images | grep "react-app")
docker build -t react-app -f Dockerfile .
docker run --name react-app -d -p 3000:3000 react-app
```

- nginx ÏÑ§Ïπò

```bash
docker run -d --name react-nginx -p 443:443 -p 80:80 nginx-react:0.1
```

- nginx - nginx.conf

```bash
events {}

http {
    client_max_body_size 10M;
    
    upstream app {
        server i6a202.p.ssafy.io:3000;
    }

    server {
        listen 80;
        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        ssl_certificate /etc/letsencrypt/live/i6b103.p.ssafy.io/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/i6b103.p.ssafy.io/privkey.pem;

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;

        ssl_prefer_server_ciphers on;
        ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;

        add_header Strict-Transport-Security "max-age=31536000" always;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        
        location / {
            proxy_pass http://app;
        }

        location /api/ {
            proxy_pass http://i6a202.p.ssafy.io:8080;
        }
    }
}
```

- nginx - Dockerfile.nginx

```bash
FROM nginx

COPY nginx.conf /etc/nginx/nginx.conf
COPY ./key/fullchain.pem /etc/letsencrypt/live/i6b103.p.ssafy.io/fullchain.pem
COPY ./key/privkey.pem /etc/letsencrypt/live/i6b103.p.ssafy.io/privkey.pem
```

- nginx - TLSÏÑ§Ï†ï
    - [https://devlopsquare.tistory.com/146](https://devlopsquare.tistory.com/146)

